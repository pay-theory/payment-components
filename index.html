<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Static Template</title>
    <style>
        a {
            font-size: 12px;
            text-align: center;
        }
        form {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            flex-direction: column;
        }

        .tab-div {
            display: flex;
        }

        .tab-div h3 {
            padding: 5px 10px;
            border: 1px black solid;
            margin: 0px 5px;
            border-radius: 40px;
            cursor: pointer;
        }



        .hidden {
            display: none;
        }
    </style>
    <script type="module"  src="./dist/index.js"></script>
</head>
<body ng-app>
<div id="main">
    <div>
        <div class="tab-div">
            <h3 id="cc-button">Credit Card</h3>
            <h3 id="ach-button">ACH</h3>
            <h3 id="cash-button">Cash</h3>
        </div>
        <form>
            <div id="card-div">
                <div id="pay-theory-credit-card"></div>
                <!-- <div id="pay-theory-credit-card-number"></div>
                <div id="pay-theory-credit-card-exp"></div>
                <div id="pay-theory-credit-card-cvv"></div> -->
                <div id="pay-theory-credit-card-zip"></div>
                <!-- <div id="pay-theory-credit-card-account-name"></div>
                <div id="pay-theory-credit-card-address-1"></div>
                <div id="pay-theory-credit-card-address-2"></div>
                <div id="pay-theory-credit-card-city"></div>
                <div id="pay-theory-credit-card-state"></div>
                <div id="pay-theory-credit-card-zip"></div> -->
            </div>
            <div id="ach-div" class="hidden">
                <!-- <div id="pay-theory-ach-account-name"></div>
                <div id="pay-theory-ach-account-number"></div>
                <div id="pay-theory-ach-routing-number"></div>
                <div id="pay-theory-ach-account-type"></div> -->
            </div>
            <div id="cash-div" class="hidden">
                <div id="pay-theory-cash-name"></div>
                <div id="pay-theory-cash-contact"></div>
            </div>
            <input
                    id="initiate-payment"
                    type="submit"
                    value="make payment"
                    disabled
            />
            <br />
            <div id="form-status"></div>
        </form>
    </div>
    <div id="result-text" />
</div>
<button
        id="reset-fields"
>Reset Fields</button>
</div>
</body>
<script type="text/javascript">

    const ccDiv = document.getElementById("card-div");
    const achDiv = document.getElementById("ach-div");
    const cashDiv = document.getElementById("cash-div");

    const showCc = () => {
        if (ccDiv.classList.contains("hidden")) {
            ccDiv.classList.remove("hidden");
            achDiv.classList.add("hidden");
            cashDiv.classList.add("hidden");
        }
    };

    const showAch = () => {
        if (achDiv.classList.contains("hidden")) {
            achDiv.classList.remove("hidden");
            cashDiv.classList.add("hidden");
            ccDiv.classList.add("hidden");
        }
    };

    const showCash = () => {
        if (cashDiv.classList.contains("hidden")) {
            achDiv.classList.add("hidden");
            ccDiv.classList.add("hidden");
            cashDiv.classList.remove("hidden");
        }
    };

    const ccButton = document.getElementById("cc-button");
    ccButton.onclick = showCc;

    const achButton = document.getElementById("ach-button");
    achButton.onclick = showAch;

    const cashButton = document.getElementById("cash-button");
    cashButton.onclick = showCash;


    // optional parameter to require confimation step
    const REQUIRE_CONFIRMATION = false

    // Discover 6542 1548 4662 3459
    // Mastercard 5454 5454 5454 5454
    // Amex 3434 343434 34343
    // Visa 4242 4242 4242 4242

    // API KEY is required
    const API_KEY = "austin-paytheorylab-d7dbe665f5565fe8ae8a23eab45dd285";
    const failureAmounts = [-1000, 10.52, 102, 193, 194, 889986, 889987]
    const amounts = [1000, 4936, 5500, 1001]
    const AMOUNT = 1000;
    const CUSTOMER_INFO = {
        first_name: "Austin",
        last_name: "Zani",
        email: "austin@paytheory.com",
        phone: "5135555555"
    };
    // optionally define custom styles for the input components text
    const STYLES = {
        default: {
            color: 'black',
            fontSize: '14px',
            paddingLeft: "8px"
        },
        success: {
            color: '#5cb85c',
            fontSize: '14px',
            paddingLeft: "8px"
        },
        error: {
            color: '#d9534f',
            fontSize: '14px',
            paddingLeft: "8px"
        },
        radio: {
            width: 18,
            fill: "blue",
            stroke: "grey",
            text: {
                fontSize: "18px",
                color: "grey",
                fontFamily: "Arial, Helvetica, sans-serif"
            }
        },
        hidePlaceholder: false
    }

    // optionally provide custom tags to help track purchases
    const TAGS = {
        "pay-theory-account-code": "7894758394",
        "pay-theory-reference": "Sports Feee",
        "pay-theory-receipt": true,
        "pay-theory-receipt-description": "This is a test"
    };

    console.log(window.paytheory)
    // const FEE_MODE = window.paytheory.SERVICE_FEE;
    const FEE_MODE = window.paytheory.INTERCHANGE;

    window.paytheory
        .create(API_KEY, STYLES, TAGS, FEE_MODE)
        .then((myCreditCard) => {
            myCreditCard.mount();

            // handle callbacks
            myCreditCard.readyObserver((ready) => {
                console.log("ready", ready);
                const paymentButton = document.getElementById("initiate-payment");
                paymentButton.addEventListener("click", (e) => {
                    e.preventDefault();
                    const statusContainer = document.getElementById("result-text");
                    statusContainer.textContent = "";
                    statusContainer.appendChild(document.createTextNode("working"));
                    // myCreditCard.initTransaction(AMOUNT, CUSTOMER_INFO);
                    console.log({
                        amount: AMOUNT,
                        customerInfo: CUSTOMER_INFO,
                        metadata: TAGS,
                        confirmation: REQUIRE_CONFIRMATION})
                    myCreditCard.transact({
                        amount: AMOUNT,
                        customerInfo: CUSTOMER_INFO,
                        metadata: TAGS,
                        confirmation: REQUIRE_CONFIRMATION});
                });

                const resetButton = document.getElementById("reset-fields");
                resetButton.addEventListener("click", (e) => {
                    e.preventDefault();
                    const fieldsArray=["pay-theory-credit-card"]
                    for(field in fieldsArray){
                        const fieldDiv = document.getElementById("pay-theory-credit-card");
                        fieldDiv.innerHTML = '';
                    }
                    const statusContainer = document.getElementById("result-text");
                    statusContainer.textContent = "";
                    myCreditCard.mount()
                });
            });

            myCreditCard.validObserver((valid) => {
                const paymentButton = document.getElementById("initiate-payment");
                console.log("valid client", valid);
                if (valid) {
                    paymentButton.removeAttribute("disabled");
                } else {
                    paymentButton.setAttribute("disabled", "");
                }
            });

            myCreditCard.errorObserver((error) => {
                const statusContainer = document.getElementById("result-text");
                statusContainer.textContent = "";
                if (error) {
                    statusContainer.appendChild(document.createTextNode(error));
                }
            });
            /**
             * optional
             * use the tokenObserver to handle confirmation step
             **/
            myCreditCard.tokenizeObserver((card) => {
                console.log(card)
                const confirmation =  `Are you sure you want to make a payment on ${card.brand} card beginning with ${card.first_six}`
                if (confirm(confirmation)) {
                    myCreditCard.confirm();
                } else {
                    myCreditCard.cancel();
                }
            });
            const completionListener = (transactionResult) => {
                console.log(transactionResult)
                const statusContainer = document.getElementById("result-text");
                statusContainer.textContent = "";
                statusContainer.appendChild(
                    document.createTextNode(JSON.stringify(transactionResult))
                );
            };
            myCreditCard.captureObserver(completionListener);
            myCreditCard.transactedObserver(completionListener);

            const cashListener = (transactionResult) => {
                console.log(transactionResult)
                const statusContainer = document.getElementById("result-text");
                statusContainer.textContent = "";
                const barcodeFrame = document.createElement("iframe")
                barcodeFrame.height = "300px"
                barcodeFrame.width = "100%"
                barcodeFrame.src = transactionResult.barcodeUrl
                barcodeFrame.frameBorder = "0"
                const barcodeLink = document.createElement("a")
                barcodeLink.appendChild(document.createTextNode('Link to Barcode'))
                barcodeLink.href = transactionResult.barcodeUrl
                barcodeLink.target = "_blank"
                barcodeLink.rel = "noopener noreferrer"
                statusContainer.appendChild(barcodeFrame);
                statusContainer.appendChild(barcodeLink);
            };

            myCreditCard.cashObserver(cashListener);
        });
</script>
</html>